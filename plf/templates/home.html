{% extends "base.html" %}

{% block content %}

  {% for item in items %}
    {% if item.status == True %}
      <div class="masonryImage lost" value={{ item.id }}>
    {% else %}
      <div class="masonryImage found" value={{ item.id }}>
    {% endif %}
    {% if item.picture %}
      <img src="..{{ item.picture.url }}" class="tileim"/>
    {% endif %}
      <p class="name">{{ item.name  }}   <span class="right-small-header">{{ item.location }}</span></p>
      <hr class="break"/>
    {% if item.status == True %}
      <p class="location">Lost
    {% else %}
      <p class="location">Found
    {% endif %}
      : {{ item.event_date }}</p>
    <p class="location">{{ item.desc }}</p>

   {% if item.status == True %}
      <button class="btn btn-mini" value="{{ item.id }}" name="{{ item.status }}">I Found This!</button>
   {% else %}
      <button class="btn btn-mini" value="{{ item.id }}" name="{{ item.status }}">This is Mine!</button>
   {% endif %}
  </div>
 {% endfor %}

 <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
 <script src="../media/jquery.isotope.min.js"></script>

 
 <script>
  $('#right').imagesLoaded( function() {
    var $but = $('.btn.btn-mini');
    $but.click( function() {
      $('.modal-footer.claiming #id').val(this.value);
      $('.modal-footer.claiming #status').val(this.name);
      $('#claimModal').modal("show");
    })

    $(function () {
      var $submit = $('#submitPopover');
      $submit.tooltip();
      $submit.tooltip('show');
      $submit.popover();
      $submit.popover({ title: 'test', placement: 'right', trigger: 'click', content: 'YAYYYY'});
    }); 

  });
 </script>

 <script>
 jQuery.expr[":"].Contains = jQuery.expr.createPseudo(function(arg) {
    return function( elem ) {
    return jQuery(elem).text().toUpperCase().indexOf(arg.toUpperCase()) >= 0;
    };
 });
 $(function() {
   var $container = $('#right');

   $container.imagesLoaded( function() {
      var $location = $('#loc');
      original_loc = $location.val();
      $location.focus(function(){
        if($(this).val()===original_loc){

          $(this).val('');
        }
      })
      .blur(function(){
        if($(this).val()===''){

          $(this).val(original_loc);
        }
      });

      var $title = $('#title');
      original_tit = $title.val();
      $title.focus(function(){
        if($(this).val()===original_tit){

          $(this).val('');
        }
      })
      .blur(function(){
        if($(this).val()===''){

          $(this).val(original_tit);
        }
      });

      var $search = $('#search');
      original_val = $search.val();
      $search.focus(function(){
        if($(this).val()===original_val){

          $(this).val('');
        }
      })
      .blur(function(){
        if($(this).val()===''){

          $(this).val(original_val);
        }
      });
      /* $search.keypress(function(){
        alert("blah");
        if($(this).val()===''){
          $container.isotope({ 

          });
        } 
      }); */

      $search.keyup(function(e) {
        if (e.keyCode == 8) {
          /*$('.masonryImage').each(function() {
            if ($(this).is(":contains('" + input + "')")) {
                $(this).removeClass('shown');
            }
          });*/
          $container.isotope({filter: "*"});
          return false;
        }
      });
      $search.keypress(function (e) {
        if (e.which == 13) {
          /* do the searching here */
          /* make the http request for json data, then parse */
          var ret;
          var count = 0;
          var input = $(this).val();
          /*
          $.getJSON("../data/", function(ret){
            $.each(ret, function(index, item){

              if (item.fields.category===input) {
                $('.masonryImage').each(function() {
                  if ($(this).attr("value")==item.pk) {
                    $(this).addClass('shown');
                    count++;
                  }
                })
              }
            });
          });*/

          $('.masonryImage').each(function() {
              if ($(this).is(":Contains('" + input.toLowerCase() + "')")) {
                $(this).addClass('shown');
                count++;
              }
            });
            if (count === 0) {
               alert("No items match your search criteria.");
            }
            else {
             $container.isotope({ filter: ".shown"});
              $('.masonryImage').each(function() {
                if ($(this).hasClass('shown')) {
                $(this).removeClass('shown');
                }
              });
            }

          return false;
        }
      });  

      $container.isotope({

      });

      $('#filters a').click(function(){
        var selector = $(this).attr('data-filter');
        $container.isotope({ filter: selector });
        return false;
      });

      $('#advSearch').click(function() {
        var location = $('#loc').val();
        var name = $('#title').val();
        var category = $('#cats').val();
        var date = $('#date').val();
        var descbox = $('#descbox').val();
        var lost = $('#lf1').is(":checked");
        var found = $('#lf2').is(":checked");
        var locY;
        var nameY;
        var catY; 
        var dateY;
        var descY;

        if (location!=="e.g. Frist") {
          locY = true;
        }
        else locY = false;
        if (name!="e.g. Black North Face Jacket") {nameY = true;}
        else nameY = false;
        if (category!=null) {catY = true;}
        else catY = false;
        if (date!="") {dateY = true;}
        else dateY = false;
        if (descbox!="") {descY = true;}
        else descY = false;

        var ret;
        var count = 0;
        var keywords = descbox.split("\n");
          
        $.getJSON("../data/", function(ret){
          alert('json');
          $.each(ret, function(index, item){
           /* alert('item');
            alert('locY'+locY);
            alert('location field' + )
            alert('nameY' + nameY);
            alert('catY' + catY);
            alert('dateY' + dateY);
            alert(lost + 'field:' + item.fields.status)*/

            if (lost && !item.fields.status) {return true;}
            if (found && item.fields.status) {return true;}
            if (catY && item.fields.category!=category[0]) return true;
            if (nameY && item.fields.name!=name) return true;
            if (dateY && item.fields.event_date!=date) return true;
            if (locY && item.fields.location!=location) return true;

            if (descY) {
              var found = false;
              $.each(keywords, function(index, element){
                var blah = item.fields.desc.toLowerCase();
                if (blah.indexOf(element) >= 0) {
                  found = true;
                }
              });
              if (found==false) { return true;}
            }

            $('.masonryImage').each(function() {
              if ($(this).attr("value")==item.pk) {
                $(this).addClass('shown');
                  count++;
              }
            });
          });
          if (count === 0) {
               alert("No items match your search criteria.");
          }
          else {
             $container.isotope({ filter: ".shown"});
             /* reset */
              $('.masonryImage').each(function() {
                if ($(this).hasClass('shown')) {
                $(this).removeClass('shown');
                }
              });
          }
        });
        return false;
      });

    });
  });

</script>

{% endblock %}
